<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no, maximum-scale=1, width=device-width, viewport-fit=cover">
        <title>TRCL Map</title>
        <link href="./assets/css/common.css" rel="stylesheet">
        <link href="./assets/css/common_responsive.css" rel="stylesheet">
        <link href="./assets/css/style.css" rel="stylesheet">
        <link href="./assets/css/responsive.css" rel="stylesheet">
        <link rel="shortcut icon" href="./assets/icon/favicon.ico" type="image/x-icon"/>
    </head>
    <body>
        <div class="loading">
            <div class="loading_box">
                <p><span></span></p>
                <h2>TRCL</h2>
            </div>
        </div><!--//loading-->

        <div class="wait">
            <p>Please Wait</p>
        </div><!--//wait-->
        
        <section class="map_section">
            <article class="map_wrap">
                <div id="map" style="width:100%;height:100%;position:relative;overflow:hidden;"></div>
                <div id="category">
                    <p id="OL7" data-order="3"><a href="./map_gas.html" class="gas">주유소</a></p>
                    <p><a href="./map_traffic.html" class="traffic active">교통</a></p>
                    <p><a href="./map_electric.html" class="electric">전기차</a></p>
                </div>
            </article>
            <span class="my_gps"></span>
        </section><!--//map_section-->
    </body>

    <script src="./assets/js/jquery-3.6.0.min.js"></script>
    <script src="./assets/js/jquery-migrate-1.4.1.min.js"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=2673091d0ce3e87c574b1905bd709c41&libraries=services,clusterer,drawing"></script>
    <script>
        // 지도 그리기
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
            level: 5 // 지도의 확대 레벨
        };
        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성
        var current_location; // 현재 위치 마커
        var location_Array = []; // 내 위치 마커 배열

        // 앱 로드 시 현 위치
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var lat = position.coords.latitude, // 위도
                lon = position.coords.longitude; // 경도
                
                var locPosition = new kakao.maps.LatLng(lat, lon);
                var current_content = '<div class ="current_marker"></div>';

                current_location = new kakao.maps.CustomOverlay({ // 현 위치 마커 설정
                    position: locPosition,
                    content: current_content
                });

                current_location.setMap(map);
                map.panTo(locPosition);
                
                $(document).ready(function(){
                    setTimeout(() => {
                        $(".loading").fadeOut(200);
                    }, 3000);
                });
            });
        }

        // 내 위치
        $(".my_gps").on("click", function(){
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var lat = position.coords.latitude, // 위도
                    lon = position.coords.longitude; // 경도
                    
                    var locPosition = new kakao.maps.LatLng(lat, lon);
                    var my_content = '<div class ="my_marker"></div>';
                    
                    my_location = new kakao.maps.CustomOverlay({ // 내 위치 마커 설정
                        position: locPosition,
                        content: my_content   
                    });
                    
                    location_Array.push(my_location);
                    location_Array.forEach(function(my_location){
                        my_location.setMap(null); // 중복된 내 위치 마커 제거
                    });
                    my_location.setMap(map);
                    
                    current_location.setMap(null); // 현 위치 마커 제거
                    map.setLevel(5);
                    map.panTo(locPosition);
                });
            }
        });

        // 교통 정보
        map.addOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);
    </script>
</html>